{% if page.author and site.data.authors[page.author] %}
  {% assign author = site.data.authors[page.author] %}{% else %}{% assign author = site.author %}
{% endif %}

<div itemscope itemtype="http://schema.org/Person" class="profile_box">

  <div class="author__avatar">
    <img src="images/me.jpg">
  </div>

  <div class="author__content">
    <h3 class="author__name">{{ author.name }}</h3>
    {% if author.bio %}<p class="author__bio">{{ author.bio }}</p>{% endif %}
  </div>

  <div class="author__urls-wrapper">
    <ul class="author__urls social-icons">
      {% if site.description %}
        <li><div style="white-space: normal; margin-bottom: 1em;">{{ site.description }}</div></li>
      {% endif %}
      {% if author.location %}
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> {{ author.location }}</li>
      {% endif %}
      {% if author.employer %}
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> {{ author.employer }}</li>
      {% endif %}

      {% if author.email %}
        <li><a href="mailto:{{ author.email }}"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i> Email</a></li>
      {% endif %}

      {% if author.googlescholar %}
        <li><a href="{{ author.googlescholar }}"><i class="fas fa-fw fa-graduation-cap" aria-hidden="true"></i> Google Scholar</a></li>
      {% endif %}

      {% if author.linkedin %}
        {% if author.linkedin contains "http" %}
          <li><a href="{{ author.linkedin }}"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        {% else %}
          <li><a href="https://www.linkedin.com/in/{{ author.linkedin | remove_first: '/' }}"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        {% endif %}
      {% endif %}

      {% if author.github %}
        {% if author.github contains "http" %}
          <li><a href="{{ author.github }}"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
        {% else %}
          <li><a href="https://github.com/{{ author.github | remove_first: '/' }}"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
        {% endif %}
      {% endif %}

      {% if author.twitter %}
        <li><a href="https://twitter.com/{{ author.twitter | remove_first: '/' }}"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> X (Twitter)</a></li>
      {% endif %}

      {% if author.bilibili %}
        <li><a href="{{ author.bilibili }}"><i class="fas fa-fw fa-play-circle" aria-hidden="true"></i> Bilibili</a></li>
      {% endif %}

      {% if author.youtube %}
        {% assign yt_id = author.youtube | remove_first: '/' %}
        {% if author.youtube contains "http" %}
          <li><a href="{{ author.youtube }}"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> YouTube</a></li>
        {% elsif yt_id contains "@" %}
          <li><a href="https://www.youtube.com/{{ yt_id }}"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> YouTube</a></li>
        {% else %}
          <li><a href="https://www.youtube.com/user/{{ yt_id }}"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> YouTube</a></li>
        {% endif %}
      {% endif %}

      <li><button type="button" class="qr-trigger" data-target="modal-wechat"><i class="fas fa-fw fa-comments" aria-hidden="true"></i> WeChat</button></li>
      <li><button type="button" class="qr-trigger" data-target="modal-qq"><i class="fas fa-fw fa-qrcode" aria-hidden="true"></i> QQ</button></li>
    </ul>

    <div class="author__urls_sm">
      {% if author.email %}
        <a href="mailto:{{ author.email }}"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i></a>
      {% endif %}
      {% if author.googlescholar %}
        <a href="{{ author.googlescholar }}"><i class="fas fa-fw fa-graduation-cap" aria-hidden="true"></i></a>
      {% endif %}
      {% if author.linkedin %}
        {% if author.linkedin contains "http" %}
          <a href="{{ author.linkedin }}"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i></a>
        {% else %}
          <a href="https://www.linkedin.com/in/{{ author.linkedin | remove_first: '/' }}"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i></a>
        {% endif %}
      {% endif %}
      {% if author.github %}
        {% if author.github contains "http" %}
          <a href="{{ author.github }}"><i class="fab fa-fw fa-github" aria-hidden="true"></i></a>
        {% else %}
          <a href="https://github.com/{{ author.github | remove_first: '/' }}"><i class="fab fa-fw fa-github" aria-hidden="true"></i></a>
        {% endif %}
      {% endif %}
      {% if author.twitter %}
        <a href="https://twitter.com/{{ author.twitter | remove_first: '/' }}"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i></a>
      {% endif %}
      {% if author.bilibili %}
        <a href="{{ author.bilibili }}"><i class="fas fa-fw fa-play-circle" aria-hidden="true"></i></a>
      {% endif %}
      {% if author.youtube %}
        {% assign yt_id = author.youtube | remove_first: '/' %}
        {% if author.youtube contains "http" %}
          <a href="{{ author.youtube }}"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i></a>
        {% elsif yt_id contains "@" %}
          <a href="https://www.youtube.com/{{ yt_id }}"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i></a>
        {% else %}
          <a href="https://www.youtube.com/user/{{ yt_id }}"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i></a>
        {% endif %}
      {% endif %}
      <button type="button" class="qr-trigger qr-trigger--icon" data-target="modal-wechat"><i class="fas fa-fw fa-comments" aria-hidden="true"></i></button>
      <button type="button" class="qr-trigger qr-trigger--icon" data-target="modal-qq"><i class="fas fa-fw fa-qrcode" aria-hidden="true"></i></button>
    </div>
  </div>
</div>

<div id="modal-qq" class="qr-modal" aria-hidden="true">
  <div class="qr-modal__backdrop"></div>
  <div class="qr-modal__dialog" role="dialog" aria-modal="true" aria-label="QQ QR">
    <button type="button" class="qr-modal__close" data-close-modal>&times;</button>
    <img src="images/contact/qq.jpg" alt="QQ QR code">
  </div>
</div>

<div id="modal-wechat" class="qr-modal" aria-hidden="true">
  <div class="qr-modal__backdrop"></div>
  <div class="qr-modal__dialog" role="dialog" aria-modal="true" aria-label="WeChat QR">
    <button type="button" class="qr-modal__close" data-close-modal>&times;</button>
    <img src="images/contact/wechat.jpg" alt="WeChat QR code">
  </div>
</div>

<script>
  (function () {
    if (window.__qrModalBound) return;
    window.__qrModalBound = true;

    function openModal(id) {
      var modal = document.getElementById(id);
      if (!modal) return;
      modal.classList.add('is-open');
      modal.setAttribute('aria-hidden', 'false');
      document.body.classList.add('overflow--hidden');
    }

    function closeModal(modal) {
      if (!modal) return;
      modal.classList.remove('is-open');
      modal.setAttribute('aria-hidden', 'true');
      document.body.classList.remove('overflow--hidden');
    }

    document.addEventListener('click', function (e) {
      var trigger = e.target.closest('.qr-trigger');
      if (trigger) {
        openModal(trigger.getAttribute('data-target'));
        return;
      }

      var closeBtn = e.target.closest('[data-close-modal], .qr-modal__backdrop');
      if (closeBtn) {
        closeModal(closeBtn.closest('.qr-modal'));
      }
    });

    document.addEventListener('keydown', function (e) {
      if (e.key !== 'Escape') return;
      var opened = document.querySelector('.qr-modal.is-open');
      closeModal(opened);
    });
  })();
</script>
